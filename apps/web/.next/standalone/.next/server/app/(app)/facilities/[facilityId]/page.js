(()=>{var e={};e.id=306,e.ids=[306],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8456:(e,a,i)=>{"use strict";i.r(a),i.d(a,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>o,routeModule:()=>u,tree:()=>d}),i(3240),i(7565),i(8844),i(2154);var s=i(7080),t=i(9920),l=i(1559),n=i.n(l),r=i(9210),c={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>r[e]);i.d(a,c);let d=["",{children:["(app)",{children:["facilities",{children:["[facilityId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,3240)),"/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/[facilityId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,7565)),"/Users/user/regintel-v2/apps/web/src/app/(app)/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,8844,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,2154)),"/Users/user/regintel-v2/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,8844,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/[facilityId]/page.tsx"],p="/(app)/facilities/[facilityId]/page",m={require:i,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/(app)/facilities/[facilityId]/page",pathname:"/facilities/[facilityId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6758:(e,a,i)=>{Promise.resolve().then(i.bind(i,9533))},9533:(e,a,i)=>{"use strict";i.r(a),i.d(a,{default:()=>u,dynamic:()=>m});var s=i(3716),t=i(2899),l=i(2367),n=i(4130),r=i(9814),c=i(6428),d=i(9580);i(20);var o=i(3653),p=i.n(o);let m="force-dynamic";function u(){let e=(0,l.useParams)(),a=(0,l.useSearchParams)(),i=(0,l.useRouter)(),o=decodeURIComponent(e.facilityId),m=a.get("provider")?decodeURIComponent(a.get("provider")):null,[u,h]=(0,t.useState)(null),[v,_]=(0,t.useState)(null),[x,g]=(0,t.useState)(!0),[j,N]=(0,t.useState)(null),[f,y]=(0,t.useState)(!1),[b,C]=(0,t.useState)(null),[I,L]=(0,t.useState)("CQC_REPORT"),[P,T]=(0,t.useState)(""),[D,w]=(0,t.useState)(!1),[H,E]=(0,t.useState)(null),V=async e=>{if(e.preventDefault(),E(null),!b){E("Please select a file");return}w(!0);try{let e=await new Promise((e,a)=>{let i=new FileReader;i.onload=()=>{let a=i.result;e(a.split(",")[1])},i.onerror=()=>a(Error("Failed to read file")),i.readAsDataURL(b)}),a=b.type||"application/pdf",i=await d.x1.createEvidenceBlob({contentBase64:e,mimeType:a});await d.x1.createFacilityEvidence({facilityId:o,blobHash:i.blobHash,evidenceType:I,fileName:b.name,description:P.trim()||void 0});let s=await d.x1.getFacilityEvidence(o);_(s),y(!1),C(null),T(""),L("CQC_REPORT")}catch(e){E(e instanceof Error?e.message:"Failed to upload evidence")}finally{w(!1)}};if(x)return s.jsx("div",{className:p().layout,children:s.jsx("div",{className:p().loading,children:"Loading facility..."})});if(j||!u||!v)return s.jsx("div",{className:p().layout,children:(0,s.jsxs)("div",{className:p().error,children:["Error: ",j||"Failed to load facility"]})});let{facility:R}=u;return(0,s.jsxs)("div",{className:p().layout,children:[s.jsx(n.Y,{providerName:u.provider?.providerName||R.facilityName,snapshotDate:u.snapshotTimestamp,topicCatalogVersion:u.topicCatalogVersion,prsLogicVersion:u.prsLogicVersion}),(0,s.jsxs)("main",{className:p().main,children:[s.jsx(r.m,{title:R.facilityName,subtitle:`CQC Location ID: ${R.cqcLocationId}`,topicCatalogVersion:u.topicCatalogVersion,topicCatalogHash:u.topicCatalogHash,prsLogicVersion:u.prsLogicVersion,prsLogicHash:u.prsLogicHash,snapshotTimestamp:u.snapshotTimestamp,domain:u.domain,reportingDomain:u.reportingDomain}),s.jsx(c.I,{topicCatalogVersion:u.topicCatalogVersion,topicCatalogHash:u.topicCatalogHash,prsLogicVersion:u.prsLogicVersion,prsLogicHash:u.prsLogicHash,snapshotTimestamp:u.snapshotTimestamp,domain:u.domain,reportingDomain:u.reportingDomain}),(0,s.jsxs)("section",{className:p().section,children:[(0,s.jsxs)("div",{className:p().sectionHeader,children:[s.jsx("h2",{className:p().sectionTitle,children:"Facility Details"}),m&&s.jsx("button",{className:p().overviewButton,onClick:()=>i.push(`/overview?provider=${m}&facility=${o}`),"data-testid":"continue-overview-button",children:"Continue to Overview"})]}),(0,s.jsxs)("div",{className:p().detailsGrid,children:[(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Provider ID:"}),s.jsx("span",{className:p().detailValueMono,children:R.providerId})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Facility ID:"}),s.jsx("span",{className:p().detailValueMono,children:R.id})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Address:"}),(0,s.jsxs)("span",{className:p().detailValue,children:[R.addressLine1,", ",R.townCity,", ",R.postcode]})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"CQC Location ID:"}),s.jsx("span",{className:p().detailValue,children:R.cqcLocationId})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Service Type:"}),s.jsx("span",{className:p().detailValue,children:R.serviceType})]}),R.capacity&&(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Capacity:"}),s.jsx("span",{className:p().detailValue,children:R.capacity})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"Facility Hash:"}),s.jsx("span",{className:p().detailValueMono,children:R.facilityHash})]}),(0,s.jsxs)("div",{className:p().detailItem,children:[s.jsx("span",{className:p().detailLabel,children:"As Of:"}),s.jsx("span",{className:p().detailValue,children:R.asOf})]})]})]}),(0,s.jsxs)("section",{className:p().section,children:[(0,s.jsxs)("div",{className:p().sectionHeader,children:[s.jsx("h2",{className:p().sectionTitle,children:"Evidence"}),s.jsx("button",{className:p().uploadButton,onClick:()=>y(!f),"data-testid":"toggle-upload-button",children:f?"Cancel Upload":"Upload Evidence"})]}),f&&(0,s.jsxs)("form",{onSubmit:V,className:p().uploadForm,children:[H&&s.jsx("div",{className:p().error,children:H}),(0,s.jsxs)("div",{className:p().formGroup,children:[s.jsx("label",{htmlFor:"file",className:p().label,children:"File (PDF, Image, Document)"}),s.jsx("input",{id:"file",type:"file",onChange:e=>{C(e.target.files?.[0]||null)},className:p().fileInput,disabled:D,"data-testid":"file-input",accept:".pdf,.png,.jpg,.jpeg,.doc,.docx"}),b&&s.jsx("span",{className:p().fileName,children:b.name})]}),(0,s.jsxs)("div",{className:p().formGroup,children:[s.jsx("label",{htmlFor:"evidenceType",className:p().label,children:"Evidence Type"}),(0,s.jsxs)("select",{id:"evidenceType",value:I,onChange:e=>L(e.target.value),className:p().select,disabled:D,"data-testid":"evidence-type-select",children:[s.jsx("option",{value:"CQC_REPORT",children:"CQC Report"}),s.jsx("option",{value:"POLICY_DOCUMENT",children:"Policy Document"}),s.jsx("option",{value:"TRAINING_RECORD",children:"Training Record"}),s.jsx("option",{value:"CERTIFICATE",children:"Certificate"}),s.jsx("option",{value:"OTHER",children:"Other"})]})]}),(0,s.jsxs)("div",{className:p().formGroup,children:[s.jsx("label",{htmlFor:"description",className:p().label,children:"Description (optional)"}),s.jsx("textarea",{id:"description",value:P,onChange:e=>T(e.target.value),className:p().textarea,disabled:D,"data-testid":"description-input",rows:3})]}),s.jsx("button",{type:"submit",className:p().submitButton,disabled:D||!b,"data-testid":"primary-upload-evidence",children:D?"Uploading...":"Upload"})]}),s.jsx("div",{className:p().evidenceList,children:0===v.evidence.length?s.jsx("div",{className:p().empty,children:"No evidence uploaded yet."}):v.evidence.map(e=>(0,s.jsxs)("div",{className:p().evidenceCard,children:[s.jsx("h4",{className:p().evidenceTitle,children:e.fileName}),(0,s.jsxs)("div",{className:p().evidenceDetails,children:[(0,s.jsxs)("span",{className:p().evidenceDetail,children:["Type: ",e.mimeType]}),(0,s.jsxs)("span",{className:p().evidenceDetail,children:["Uploaded: ",new Date(e.uploadedAt).toLocaleDateString()]}),(0,s.jsxs)("span",{className:p().evidenceDetail,children:["Evidence: ",e.evidenceType]})]}),(0,s.jsxs)("div",{className:p().evidenceHash,children:["Hash: ",e.blobHash.substring(0,16),"..."]})]},e.evidenceRecordId))})]})]})]})}},3653:e=>{e.exports={layout:"page_layout__89xst",main:"page_main__PAoHw",loading:"page_loading__jwB3E",error:"page_error__hzws8",section:"page_section__FKzzP",sectionHeader:"page_sectionHeader__ijry6",sectionTitle:"page_sectionTitle___dWEh",overviewButton:"page_overviewButton__5wceo",detailsGrid:"page_detailsGrid__A0hFT",detailItem:"page_detailItem__VIpb7",detailLabel:"page_detailLabel__qOPXP",detailValue:"page_detailValue__iKsQV",detailValueMono:"page_detailValueMono__o2Shy",uploadButton:"page_uploadButton__xp_HR",uploadForm:"page_uploadForm__0xhkK",formGroup:"page_formGroup__mCLs3",label:"page_label__AzTHW",fileInput:"page_fileInput__mmGOe",select:"page_select__MfvCM",textarea:"page_textarea__EX2Ds",fileName:"page_fileName__aAqBH",submitButton:"page_submitButton__fneEe",evidenceList:"page_evidenceList__7HJoW",evidenceCard:"page_evidenceCard__afeYD",evidenceTitle:"page_evidenceTitle__vtMvG",evidenceDetails:"page_evidenceDetails__bARO3",evidenceDetail:"page_evidenceDetail__6vHWS",evidenceHash:"page_evidenceHash__Aky28",empty:"page_empty__JmRW7"}},3240:(e,a,i)=>{"use strict";i.r(a),i.d(a,{default:()=>l,dynamic:()=>t});var s=i(436);let t=(0,s.createProxy)(String.raw`/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/[facilityId]/page.tsx#dynamic`),l=(0,s.createProxy)(String.raw`/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/[facilityId]/page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var i=e=>a(a.s=e),s=a.X(0,[283,322,109],()=>i(8456));module.exports=s})();