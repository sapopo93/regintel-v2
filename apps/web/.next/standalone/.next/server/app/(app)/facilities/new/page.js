(()=>{var e={};e.id=103,e.ids=[103],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2099:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>l}),i(8198),i(7565),i(8844),i(2154);var s=i(7080),r=i(9920),a=i(1559),n=i.n(a),o=i(9210),c={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);i.d(t,c);let l=["",{children:["(app)",{children:["facilities",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,8198)),"/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,7565)),"/Users/user/regintel-v2/apps/web/src/app/(app)/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,8844,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,2154)),"/Users/user/regintel-v2/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,8844,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/new/page.tsx"],u="/(app)/facilities/new/page",p={require:i,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(app)/facilities/new/page",pathname:"/facilities/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},919:(e,t,i)=>{Promise.resolve().then(i.t.bind(i,7634,23)),Promise.resolve().then(i.t.bind(i,9952,23)),Promise.resolve().then(i.t.bind(i,7544,23)),Promise.resolve().then(i.t.bind(i,6946,23)),Promise.resolve().then(i.t.bind(i,9087,23)),Promise.resolve().then(i.t.bind(i,3625,23))},623:(e,t,i)=>{Promise.resolve().then(i.bind(i,4991))},4129:()=>{},9652:()=>{},2367:(e,t,i)=>{"use strict";var s=i(3117);i.o(s,"useParams")&&i.d(t,{useParams:function(){return s.useParams}}),i.o(s,"usePathname")&&i.d(t,{usePathname:function(){return s.usePathname}}),i.o(s,"useRouter")&&i.d(t,{useRouter:function(){return s.useRouter}}),i.o(s,"useSearchParams")&&i.d(t,{useSearchParams:function(){return s.useSearchParams}})},4991:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u,dynamic:()=>l});var s=i(3716),r=i(2899),a=i(2367),n=i(9580),o=i(2765),c=i.n(o);let l="force-dynamic",d=/^1-[0-9]{9,11}$/;function u(){let e=(0,a.useSearchParams)(),t=(0,a.useRouter)(),i=e.get("provider"),[o,l]=(0,r.useState)(""),[u,p]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[x,b]=(0,r.useState)("residential"),[_,C]=(0,r.useState)(""),[N,S]=(0,r.useState)(!1),[j,P]=(0,r.useState)(!1),[I,$]=(0,r.useState)(null),[T,w]=(0,r.useState)(!1),[q,E]=(0,r.useState)(null),O=async()=>{if($(null),!i){$("Provider ID is required");return}if(!g.trim()){$("CQC Location ID is required");return}if(!d.test(g.trim())){$("CQC Location ID must match format: 1-XXXXXXXXX (9-11 digits after the dash)");return}P(!0);try{let e={providerId:i,cqcLocationId:g.trim()},t=await n.x1.onboardFacility(e);t.cqcData?(l(t.facility.facilityName),p(t.facility.addressLine1),m(t.facility.townCity),v(t.facility.postcode),b(t.facility.serviceType),C(t.facility.capacity?.toString()||""),w(!0),E(t.dataSource),$(null)):($("Facility not found in CQC API. Please enter details manually."),E("MANUAL"),w(!0)),P(!1)}catch(t){let e="Failed to fetch CQC data. Please enter details manually.";if(t instanceof n.MS){let i=t.response?.error;i&&(e=i)}else t instanceof Error&&(e=t.message);$(e),E("MANUAL"),w(!0),P(!1)}},A=async e=>{if(e.preventDefault(),$(null),!i){$("Provider ID is required");return}if(!T){$('Please fetch facility data from CQC first using the "Fetch from CQC" button');return}if(!o.trim()||!u.trim()||!h.trim()||!f.trim()||!g.trim()||!x.trim()){$("All required fields must be filled");return}S(!0);try{let e={providerId:i,cqcLocationId:g.trim(),facilityName:o.trim(),addressLine1:u.trim(),townCity:h.trim(),postcode:f.trim(),serviceType:x.trim(),capacity:_.trim()?parseInt(_.trim(),10):void 0},s=await n.x1.onboardFacility(e),r=i?`?provider=${i}`:"";t.push(`/facilities/${s.facility.id}${r}`)}catch(e){$(e instanceof Error?e.message:"Failed to create facility"),S(!1)}};return s.jsx("div",{className:c().layout,children:s.jsx("main",{className:c().main,children:(0,s.jsxs)("div",{className:c().formContainer,children:[s.jsx("h1",{className:c().title,children:"Add New Facility"}),I&&s.jsx("div",{className:c().error,children:I}),T&&"CQC_API"===q&&s.jsx("div",{className:c().success,children:"✅ Facility data successfully fetched from CQC API"}),(0,s.jsxs)("form",{onSubmit:A,className:c().form,children:[(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"cqcLocationId",className:c().label,children:["CQC Location ID ",s.jsx("span",{className:c().required,children:"*"})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[s.jsx("input",{id:"cqcLocationId",type:"text",value:g,onChange:e=>{y(e.target.value),w(!1)},className:c().input,required:!0,disabled:N||j,"data-testid":"cqc-location-id-input",placeholder:"e.g., 1-123456789",style:{flex:1}}),s.jsx("button",{type:"button",onClick:O,className:c().fetchButton,disabled:N||j||!g.trim(),"data-testid":"fetch-cqc-button",children:j?"Fetching...":"Fetch from CQC"})]}),s.jsx("small",{className:c().hint,children:'Enter CQC Location ID and click "Fetch from CQC" to auto-populate all fields'})]}),T&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"facilityName",className:c().label,children:["Facility Name ",s.jsx("span",{className:c().required,children:"*"})]}),s.jsx("input",{id:"facilityName",type:"text",value:o,onChange:e=>l(e.target.value),className:c().input,required:!0,disabled:N,"data-testid":"facility-name-input"})]}),(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"addressLine1",className:c().label,children:["Address Line 1 ",s.jsx("span",{className:c().required,children:"*"})]}),s.jsx("input",{id:"addressLine1",type:"text",value:u,onChange:e=>p(e.target.value),className:c().input,required:!0,disabled:N,"data-testid":"address-line1-input"})]}),(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"townCity",className:c().label,children:["Town / City ",s.jsx("span",{className:c().required,children:"*"})]}),s.jsx("input",{id:"townCity",type:"text",value:h,onChange:e=>m(e.target.value),className:c().input,required:!0,disabled:N,"data-testid":"town-city-input"})]}),(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"postcode",className:c().label,children:["Postcode ",s.jsx("span",{className:c().required,children:"*"})]}),s.jsx("input",{id:"postcode",type:"text",value:f,onChange:e=>v(e.target.value),className:c().input,required:!0,disabled:N,"data-testid":"postcode-input"})]}),(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsxs)("label",{htmlFor:"serviceType",className:c().label,children:["Service Type ",s.jsx("span",{className:c().required,children:"*"})]}),(0,s.jsxs)("select",{id:"serviceType",value:x,onChange:e=>b(e.target.value),className:c().select,required:!0,disabled:N,"data-testid":"service-type-select",children:[s.jsx("option",{value:"residential",children:"Residential"}),s.jsx("option",{value:"nursing",children:"Nursing"}),s.jsx("option",{value:"domiciliary",children:"Domiciliary"}),s.jsx("option",{value:"supported_living",children:"Supported Living"}),s.jsx("option",{value:"hospice",children:"Hospice"})]})]}),(0,s.jsxs)("div",{className:c().formGroup,children:[s.jsx("label",{htmlFor:"capacity",className:c().label,children:"Capacity (beds/service users)"}),s.jsx("input",{id:"capacity",type:"number",value:_,onChange:e=>C(e.target.value),className:c().input,disabled:N,"data-testid":"capacity-input",min:"1"})]})]}),(0,s.jsxs)("div",{className:c().formActions,children:[s.jsx("button",{type:"button",onClick:()=>{let e=i?`?provider=${i}`:"";t.push(`/facilities${e}`)},className:c().cancelButton,disabled:N||j,children:"Cancel"}),s.jsx("button",{type:"submit",className:c().submitButton,disabled:N||j||!T,"data-testid":"primary-create-facility",children:N?"Creating...":"Create Facility"})]})]})]})})})}},9580:(e,t,i)=>{"use strict";i.d(t,{MS:()=>a,x1:()=>o});var s=i(20),r=i(7950);class a extends Error{constructor(e,t,i){super(e),this.status=t,this.response=i,this.name="ApiError"}}class n{constructor(e){this.config=e}async fetch(e,t){let i=`${this.config.baseUrl}${e}`,n=(0,r.bW)(),o=await fetch(i,{...t,headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{},...this.config.tenantId?{"X-Tenant-Id":this.config.tenantId}:{},...t?.headers}});if((401===o.status||403===o.status)&&(0,r.Rn)(),!o.ok){let e=await o.json().catch(()=>({})),t=e.error||o.statusText;throw new a(`API request failed: ${t}`,o.status,e)}let c=await o.json();return function(e){let t=[];if(e.topicCatalogVersion||t.push("topicCatalogVersion"),e.topicCatalogHash||t.push("topicCatalogHash"),e.prsLogicVersion||t.push("prsLogicVersion"),e.prsLogicHash||t.push("prsLogicHash"),e.snapshotTimestamp||t.push("snapshotTimestamp"),e.domain||t.push("domain"),e.reportingDomain||t.push("reportingDomain"),t.length>0)throw new s.L2(`API response missing constitutional metadata: ${t.join(", ")}`,t)}(c),c}async getProviders(){return this.fetch("/v1/providers")}async createProvider(e){return this.fetch("/v1/providers",{method:"POST",body:JSON.stringify(e)})}async getProviderOverview(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/overview${i}`)}async getTopics(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/topics${i}`)}async getTopic(e,t,i){let s=i?`?facility=${encodeURIComponent(i)}`:"";return this.fetch(`/v1/providers/${e}/topics/${t}${s}`)}async getMockSessions(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/mock-sessions${i}`)}async createMockSession(e,t,i){return this.fetch(`/v1/providers/${e}/mock-sessions`,{method:"POST",body:JSON.stringify({topicId:t,facilityId:i})})}async getMockSession(e,t,i){let s=i?`?facility=${encodeURIComponent(i)}`:"";return this.fetch(`/v1/providers/${e}/mock-sessions/${t}${s}`)}async submitAnswer(e,t,i){return this.fetch(`/v1/providers/${e}/mock-sessions/${t}/answer`,{method:"POST",body:JSON.stringify({answer:i})})}async getFindings(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/findings${i}`)}async getFinding(e,t){return this.fetch(`/v1/providers/${e}/findings/${t}`)}async getEvidence(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/evidence${i}`)}async getAuditTrail(e){return this.fetch(`/v1/providers/${e}/audit-trail`)}async generateExport(e,t){return this.fetch(`/v1/providers/${e}/exports`,{method:"POST",body:JSON.stringify(t)})}async getExportStatus(e,t){let i=t?`?facility=${encodeURIComponent(t)}`:"";return this.fetch(`/v1/providers/${e}/exports${i}`)}async getFacilities(e){let t=e?`/v1/providers/${e}/facilities`:"/v1/facilities";return this.fetch(t)}async onboardFacility(e){return this.fetch("/v1/facilities/onboard",{method:"POST",body:JSON.stringify(e)})}async createFacility(e){return this.fetch(`/v1/providers/${e.providerId}/facilities`,{method:"POST",body:JSON.stringify(e)})}async getFacility(e){return this.fetch(`/v1/facilities/${e}`)}async createEvidenceBlob(e){return this.fetch("/v1/evidence/blobs",{method:"POST",body:JSON.stringify(e)})}async createFacilityEvidence(e){return this.fetch(`/v1/facilities/${e.facilityId}/evidence`,{method:"POST",body:JSON.stringify(e)})}async getFacilityEvidence(e){return this.fetch(`/v1/facilities/${e}/evidence`)}}let o=new n({baseUrl:"http://localhost:3001"})},7950:(e,t,i)=>{"use strict";function s(){return null}function r(){return null}function a(e,t){}function n(){}i.d(t,{Rn:()=>n,bW:()=>s,sW:()=>r,uB:()=>a})},2652:(e,t,i)=>{"use strict";i.d(t,{lE:()=>a,qN:()=>r,tx:()=>s,y8:()=>n});let s="READINESS (MOCK) — NOT REGULATORY HISTORY",r={SYSTEM_MOCK:"SYSTEM_MOCK",ACTUAL_INSPECTION:"ACTUAL_INSPECTION",SELF_IDENTIFIED:"SELF_IDENTIFIED"},a={MOCK_SIMULATION:"MOCK_SIMULATION",REGULATORY_HISTORY:"REGULATORY_HISTORY"},n=[{id:"providers",label:"Providers",href:"/providers"},{id:"overview",label:"Overview",href:"/overview"},{id:"topics",label:"Topics",href:"/topics"},{id:"mock-session",label:"Mock Inspection",href:"/mock-session"},{id:"findings",label:"Findings",href:"/findings"},{id:"facilities",label:"Facilities",href:"/facilities"},{id:"evidence",label:"Evidence",href:"/evidence"},{id:"exports",label:"Exports",href:"/exports"},{id:"audit",label:"Audit Trail",href:"/audit"}]},20:(e,t,i)=>{"use strict";i.d(t,{Eb:()=>n,L2:()=>r,Uu:()=>a});var s=i(2652);class r extends Error{constructor(e,t){super(e),this.missingRequirements=t,this.name="ConstitutionalViolationError"}}function a(e,t){let i=[],s=!!(e.topicCatalogVersion&&e.prsLogicVersion),a=!!(e.topicCatalogHash&&e.topicCatalogHash.length>0&&e.prsLogicHash&&e.prsLogicHash.length>0),n=!!e.snapshotTimestamp,o=!!e.domain;if(s||i.push("version"),a||i.push("hash"),n||i.push("timestamp"),o||i.push("domain"),t?.strict&&i.length>0)throw new r(`Constitutional UI violation: missing ${i.join(", ")}`,i);return{valid:0===i.length,hasVersion:s,hasHash:a,hasTimestamp:n,hasDomain:o,missingRequirements:i}}function n(e){return e.origin===s.qN.SYSTEM_MOCK||e.reportingDomain===s.lE.MOCK_SIMULATION?{borderColor:"var(--color-simulation)",borderWidth:"4px"}:null}},2765:e=>{e.exports={layout:"page_layout__Vd0f8",main:"page_main__xUV9l",formContainer:"page_formContainer__o_JgH",title:"page_title__6mF4A",form:"page_form__jXypo",formGroup:"page_formGroup__aIUrx",label:"page_label__ovzRv",required:"page_required__pyeKq",input:"page_input__aiaG2",textarea:"page_textarea__S1y10",select:"page_select__aQqAB",formActions:"page_formActions__3ejqq",cancelButton:"page_cancelButton__6mh88",submitButton:"page_submitButton__Z1B45",error:"page_error__HEpRt",success:"page_success__cRGe8",fetchButton:"page_fetchButton__76lcS",hint:"page_hint__iTek3"}},8198:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,dynamic:()=>r});var s=i(436);let r=(0,s.createProxy)(String.raw`/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/new/page.tsx#dynamic`),a=(0,s.createProxy)(String.raw`/Users/user/regintel-v2/apps/web/src/app/(app)/facilities/new/page.tsx#default`)},7565:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o,dynamic:()=>r,fetchCache:()=>n,revalidate:()=>a});var s=i(9785);let r="force-dynamic",a=0,n="force-no-store";function o({children:e}){return s.jsx(s.Fragment,{children:e})}},2154:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,metadata:()=>r});var s=i(9785);i(6282);let r={title:"RegIntel v2 - Regulatory Compliance Intelligence",description:"Evidence-based compliance for UK CQC-registered care providers"};function a({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{children:e})})}},6282:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[283],()=>i(2099));module.exports=s})();