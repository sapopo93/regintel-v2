(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{1790:function(e,t,i){Promise.resolve().then(i.bind(i,9344))},7345:function(e,t,i){"use strict";var a=i(1886);i.o(a,"useParams")&&i.d(t,{useParams:function(){return a.useParams}}),i.o(a,"usePathname")&&i.d(t,{usePathname:function(){return a.usePathname}}),i.o(a,"useRouter")&&i.d(t,{useRouter:function(){return a.useRouter}}),i.o(a,"useSearchParams")&&i.d(t,{useSearchParams:function(){return a.useSearchParams}})},9344:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return u},dynamic:function(){return l}});var a=i(6969),n=i(5645),s=i(7345),r=i(161),c=i(3425),o=i.n(c);let l="force-dynamic",d=/^1-[0-9]{9,11}$/;function u(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),i=e.get("provider"),[c,l]=(0,n.useState)(""),[u,h]=(0,n.useState)(""),[p,m]=(0,n.useState)(""),[f,v]=(0,n.useState)(""),[g,y]=(0,n.useState)(""),[C,_]=(0,n.useState)("residential"),[b,x]=(0,n.useState)(""),[S,N]=(0,n.useState)(!1),[I,j]=(0,n.useState)(!1),[T,w]=(0,n.useState)(null),[O,E]=(0,n.useState)(!1),[L,F]=(0,n.useState)(null),R=async()=>{var e,t;if(w(null),!i){w("Provider ID is required");return}if(!g.trim()){w("CQC Location ID is required");return}if(!d.test(g.trim())){w("CQC Location ID must match format: 1-XXXXXXXXX (9-11 digits after the dash)");return}j(!0);try{let t={providerId:i,cqcLocationId:g.trim()},a=await r.x1.onboardFacility(t);a.cqcData?(l(a.facility.facilityName),h(a.facility.addressLine1),m(a.facility.townCity),v(a.facility.postcode),_(a.facility.serviceType),x((null===(e=a.facility.capacity)||void 0===e?void 0:e.toString())||""),E(!0),F(a.dataSource),w(null)):(w("Facility not found in CQC API. Please enter details manually."),F("MANUAL"),E(!0)),j(!1)}catch(i){let e="Failed to fetch CQC data. Please enter details manually.";if(i instanceof r.MS){let a=null===(t=i.response)||void 0===t?void 0:t.error;a&&(e=a)}else i instanceof Error&&(e=i.message);w(e),F("MANUAL"),E(!0),j(!1)}},P=async e=>{if(e.preventDefault(),w(null),!i){w("Provider ID is required");return}if(!O){w('Please fetch facility data from CQC first using the "Fetch from CQC" button');return}if(!c.trim()||!u.trim()||!p.trim()||!f.trim()||!g.trim()||!C.trim()){w("All required fields must be filled");return}N(!0);try{let e={providerId:i,cqcLocationId:g.trim(),facilityName:c.trim(),addressLine1:u.trim(),townCity:p.trim(),postcode:f.trim(),serviceType:C.trim(),capacity:b.trim()?parseInt(b.trim(),10):void 0},a=await r.x1.onboardFacility(e),n=i?"?provider=".concat(i):"";t.push("/facilities/".concat(a.facility.id).concat(n))}catch(e){w(e instanceof Error?e.message:"Failed to create facility"),N(!1)}};return(0,a.jsx)("div",{className:o().layout,children:(0,a.jsx)("main",{className:o().main,children:(0,a.jsxs)("div",{className:o().formContainer,children:[(0,a.jsx)("h1",{className:o().title,children:"Add New Facility"}),T&&(0,a.jsx)("div",{className:o().error,children:T}),O&&"CQC_API"===L&&(0,a.jsx)("div",{className:o().success,children:"✅ Facility data successfully fetched from CQC API"}),(0,a.jsxs)("form",{onSubmit:P,className:o().form,children:[(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"cqcLocationId",className:o().label,children:["CQC Location ID ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,a.jsx)("input",{id:"cqcLocationId",type:"text",value:g,onChange:e=>{y(e.target.value),E(!1)},className:o().input,required:!0,disabled:S||I,"data-testid":"cqc-location-id-input",placeholder:"e.g., 1-123456789",style:{flex:1}}),(0,a.jsx)("button",{type:"button",onClick:R,className:o().fetchButton,disabled:S||I||!g.trim(),"data-testid":"fetch-cqc-button",children:I?"Fetching...":"Fetch from CQC"})]}),(0,a.jsx)("small",{className:o().hint,children:'Enter CQC Location ID and click "Fetch from CQC" to auto-populate all fields'})]}),O&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"facilityName",className:o().label,children:["Facility Name ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsx)("input",{id:"facilityName",type:"text",value:c,onChange:e=>l(e.target.value),className:o().input,required:!0,disabled:S,"data-testid":"facility-name-input"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"addressLine1",className:o().label,children:["Address Line 1 ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsx)("input",{id:"addressLine1",type:"text",value:u,onChange:e=>h(e.target.value),className:o().input,required:!0,disabled:S,"data-testid":"address-line1-input"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"townCity",className:o().label,children:["Town / City ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsx)("input",{id:"townCity",type:"text",value:p,onChange:e=>m(e.target.value),className:o().input,required:!0,disabled:S,"data-testid":"town-city-input"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"postcode",className:o().label,children:["Postcode ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsx)("input",{id:"postcode",type:"text",value:f,onChange:e=>v(e.target.value),className:o().input,required:!0,disabled:S,"data-testid":"postcode-input"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"serviceType",className:o().label,children:["Service Type ",(0,a.jsx)("span",{className:o().required,children:"*"})]}),(0,a.jsxs)("select",{id:"serviceType",value:C,onChange:e=>_(e.target.value),className:o().select,required:!0,disabled:S,"data-testid":"service-type-select",children:[(0,a.jsx)("option",{value:"residential",children:"Residential"}),(0,a.jsx)("option",{value:"nursing",children:"Nursing"}),(0,a.jsx)("option",{value:"domiciliary",children:"Domiciliary"}),(0,a.jsx)("option",{value:"supported_living",children:"Supported Living"}),(0,a.jsx)("option",{value:"hospice",children:"Hospice"})]})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"capacity",className:o().label,children:"Capacity (beds/service users)"}),(0,a.jsx)("input",{id:"capacity",type:"number",value:b,onChange:e=>x(e.target.value),className:o().input,disabled:S,"data-testid":"capacity-input",min:"1"})]})]}),(0,a.jsxs)("div",{className:o().formActions,children:[(0,a.jsx)("button",{type:"button",onClick:()=>{let e=i?"?provider=".concat(i):"";t.push("/facilities".concat(e))},className:o().cancelButton,disabled:S||I,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:o().submitButton,disabled:S||I||!O,"data-testid":"primary-create-facility",children:S?"Creating...":"Create Facility"})]})]})]})})})}},161:function(e,t,i){"use strict";i.d(t,{MS:function(){return s},x1:function(){return c}});var a=i(1478),n=i(1545);class s extends Error{constructor(e,t,i){super(e),this.status=t,this.response=i,this.name="ApiError"}}class r{async fetch(e,t){let i="".concat(this.config.baseUrl).concat(e),r=(0,n.bW)(),c=await fetch(i,{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...this.config.tenantId?{"X-Tenant-Id":this.config.tenantId}:{},...null==t?void 0:t.headers}});if(401===c.status||403===c.status){(0,n.Rn)();{let e=window.location.pathname+window.location.search;window.location.href="/login?next=".concat(encodeURIComponent(e))}}if(!c.ok){let e=await c.json().catch(()=>({})),t=e.error||c.statusText;throw new s("API request failed: ".concat(t),c.status,e)}let o=await c.json();return!function(e){let t=[];if(e.topicCatalogVersion||t.push("topicCatalogVersion"),e.topicCatalogHash||t.push("topicCatalogHash"),e.prsLogicVersion||t.push("prsLogicVersion"),e.prsLogicHash||t.push("prsLogicHash"),e.snapshotTimestamp||t.push("snapshotTimestamp"),e.domain||t.push("domain"),e.reportingDomain||t.push("reportingDomain"),t.length>0)throw new a.L2("API response missing constitutional metadata: ".concat(t.join(", ")),t)}(o),o}async getProviders(){return this.fetch("/v1/providers")}async createProvider(e){return this.fetch("/v1/providers",{method:"POST",body:JSON.stringify(e)})}async getProviderOverview(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/overview").concat(i))}async getTopics(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/topics").concat(i))}async getTopic(e,t,i){let a=i?"?facility=".concat(encodeURIComponent(i)):"";return this.fetch("/v1/providers/".concat(e,"/topics/").concat(t).concat(a))}async getMockSessions(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/mock-sessions").concat(i))}async createMockSession(e,t,i){return this.fetch("/v1/providers/".concat(e,"/mock-sessions"),{method:"POST",body:JSON.stringify({topicId:t,facilityId:i})})}async getMockSession(e,t,i){let a=i?"?facility=".concat(encodeURIComponent(i)):"";return this.fetch("/v1/providers/".concat(e,"/mock-sessions/").concat(t).concat(a))}async submitAnswer(e,t,i){return this.fetch("/v1/providers/".concat(e,"/mock-sessions/").concat(t,"/answer"),{method:"POST",body:JSON.stringify({answer:i})})}async getFindings(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/findings").concat(i))}async getFinding(e,t){return this.fetch("/v1/providers/".concat(e,"/findings/").concat(t))}async getEvidence(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/evidence").concat(i))}async getAuditTrail(e){return this.fetch("/v1/providers/".concat(e,"/audit-trail"))}async generateExport(e,t){return this.fetch("/v1/providers/".concat(e,"/exports"),{method:"POST",body:JSON.stringify(t)})}async getExportStatus(e,t){let i=t?"?facility=".concat(encodeURIComponent(t)):"";return this.fetch("/v1/providers/".concat(e,"/exports").concat(i))}async getFacilities(e){return this.fetch(e?"/v1/providers/".concat(e,"/facilities"):"/v1/facilities")}async onboardFacility(e){return this.fetch("/v1/facilities/onboard",{method:"POST",body:JSON.stringify(e)})}async createFacility(e){return this.fetch("/v1/providers/".concat(e.providerId,"/facilities"),{method:"POST",body:JSON.stringify(e)})}async getFacility(e){return this.fetch("/v1/facilities/".concat(e))}async createEvidenceBlob(e){return this.fetch("/v1/evidence/blobs",{method:"POST",body:JSON.stringify(e)})}async createFacilityEvidence(e){return this.fetch("/v1/facilities/".concat(e.facilityId,"/evidence"),{method:"POST",body:JSON.stringify(e)})}async getFacilityEvidence(e){return this.fetch("/v1/facilities/".concat(e,"/evidence"))}constructor(e){this.config=e}}let c=new r({baseUrl:"http://localhost:3001"})},1545:function(e,t,i){"use strict";i.d(t,{Rn:function(){return o},bW:function(){return s},sW:function(){return r},uB:function(){return c}});let a="regintel.auth.token",n="regintel.auth.role";function s(){return window.localStorage.getItem(a)}function r(){return window.localStorage.getItem(n)}function c(e,t){window.localStorage.setItem(a,e),window.localStorage.setItem(n,t)}function o(){window.localStorage.removeItem(a),window.localStorage.removeItem(n)}},3924:function(e,t,i){"use strict";i.d(t,{lE:function(){return s},qN:function(){return n},tx:function(){return a},y8:function(){return r}});let a="READINESS (MOCK) — NOT REGULATORY HISTORY",n={SYSTEM_MOCK:"SYSTEM_MOCK",ACTUAL_INSPECTION:"ACTUAL_INSPECTION",SELF_IDENTIFIED:"SELF_IDENTIFIED"},s={MOCK_SIMULATION:"MOCK_SIMULATION",REGULATORY_HISTORY:"REGULATORY_HISTORY"},r=[{id:"providers",label:"Providers",href:"/providers"},{id:"overview",label:"Overview",href:"/overview"},{id:"topics",label:"Topics",href:"/topics"},{id:"mock-session",label:"Mock Inspection",href:"/mock-session"},{id:"findings",label:"Findings",href:"/findings"},{id:"facilities",label:"Facilities",href:"/facilities"},{id:"evidence",label:"Evidence",href:"/evidence"},{id:"exports",label:"Exports",href:"/exports"},{id:"audit",label:"Audit Trail",href:"/audit"}]},1478:function(e,t,i){"use strict";i.d(t,{Eb:function(){return c},L2:function(){return n},Lg:function(){return r},Uu:function(){return s}});var a=i(3924);class n extends Error{constructor(e,t){super(e),this.missingRequirements=t,this.name="ConstitutionalViolationError"}}function s(e,t){let i=[],a=!!(e.topicCatalogVersion&&e.prsLogicVersion),s=!!(e.topicCatalogHash&&e.topicCatalogHash.length>0&&e.prsLogicHash&&e.prsLogicHash.length>0),r=!!e.snapshotTimestamp,c=!!e.domain;if(a||i.push("version"),s||i.push("hash"),r||i.push("timestamp"),c||i.push("domain"),(null==t?void 0:t.strict)&&i.length>0)throw new n("Constitutional UI violation: missing ".concat(i.join(", ")),i);return{valid:0===i.length,hasVersion:a,hasHash:s,hasTimestamp:r,hasDomain:c,missingRequirements:i}}function r(e){if(e.origin===a.qN.SYSTEM_MOCK&&e.reportingDomain===a.lE.REGULATORY_HISTORY)throw Error("Mock contamination detected: Finding ".concat(e.id," has origin=SYSTEM_MOCK ")+"in reportingDomain=REGULATORY_HISTORY. This violates regulatory/mock separation.")}function c(e){return e.origin===a.qN.SYSTEM_MOCK||e.reportingDomain===a.lE.MOCK_SIMULATION?{borderColor:"var(--color-simulation)",borderWidth:"4px"}:null}},3425:function(e){e.exports={layout:"page_layout__Vd0f8",main:"page_main__xUV9l",formContainer:"page_formContainer__o_JgH",title:"page_title__6mF4A",form:"page_form__jXypo",formGroup:"page_formGroup__aIUrx",label:"page_label__ovzRv",required:"page_required__pyeKq",input:"page_input__aiaG2",textarea:"page_textarea__S1y10",select:"page_select__aQqAB",formActions:"page_formActions__3ejqq",cancelButton:"page_cancelButton__6mh88",submitButton:"page_submitButton__Z1B45",error:"page_error__HEpRt",success:"page_success__cRGe8",fetchButton:"page_fetchButton__76lcS",hint:"page_hint__iTek3"}}},function(e){e.O(0,[805,939,325,744],function(){return e(e.s=1790)}),_N_E=e.O()}]);