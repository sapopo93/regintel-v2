(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{4364:function(e,a,i){Promise.resolve().then(i.bind(i,4378))},4378:function(e,a,i){"use strict";i.r(a),i.d(a,{default:function(){return h},dynamic:function(){return u}});var s=i(6969),l=i(5645),t=i(7345),n=i(3565),c=i(8604),d=i(9288),o=i(161),r=i(1478),p=i(9156),m=i.n(p);let u="force-dynamic";function h(){var e;let a=(0,t.useParams)(),i=(0,t.useSearchParams)(),p=(0,t.useRouter)(),u=decodeURIComponent(a.facilityId),h=i.get("provider")?decodeURIComponent(i.get("provider")):null,[v,_]=(0,l.useState)(null),[x,g]=(0,l.useState)(null),[N,j]=(0,l.useState)(!0),[f,y]=(0,l.useState)(null),[b,C]=(0,l.useState)(!1),[L,I]=(0,l.useState)(null),[T,D]=(0,l.useState)("CQC_REPORT"),[H,E]=(0,l.useState)(""),[V,F]=(0,l.useState)(!1),[R,w]=(0,l.useState)(null);(0,l.useEffect)(()=>{Promise.all([o.x1.getFacility(u),o.x1.getFacilityEvidence(u)]).then(e=>{let[a,i]=e;(0,r.Uu)(a,{strict:!0}),(0,r.Uu)(i,{strict:!0}),_(a),g(i)}).catch(e=>y(e.message)).finally(()=>j(!1))},[u]);let P=async e=>{if(e.preventDefault(),w(null),!L){w("Please select a file");return}F(!0);try{let e=await new Promise((e,a)=>{let i=new FileReader;i.onload=()=>{let a=i.result;e(a.split(",")[1])},i.onerror=()=>a(Error("Failed to read file")),i.readAsDataURL(L)}),a=L.type||"application/pdf",i=await o.x1.createEvidenceBlob({contentBase64:e,mimeType:a});await o.x1.createFacilityEvidence({facilityId:u,blobHash:i.blobHash,evidenceType:T,fileName:L.name,description:H.trim()||void 0});let s=await o.x1.getFacilityEvidence(u);g(s),C(!1),I(null),E(""),D("CQC_REPORT")}catch(e){w(e instanceof Error?e.message:"Failed to upload evidence")}finally{F(!1)}};if(N)return(0,s.jsx)("div",{className:m().layout,children:(0,s.jsx)("div",{className:m().loading,children:"Loading facility..."})});if(f||!v||!x)return(0,s.jsx)("div",{className:m().layout,children:(0,s.jsxs)("div",{className:m().error,children:["Error: ",f||"Failed to load facility"]})});let{facility:O}=v;return(0,s.jsxs)("div",{className:m().layout,children:[(0,s.jsx)(n.Y,{providerName:(null===(e=v.provider)||void 0===e?void 0:e.providerName)||O.facilityName,snapshotDate:v.snapshotTimestamp,topicCatalogVersion:v.topicCatalogVersion,prsLogicVersion:v.prsLogicVersion}),(0,s.jsxs)("main",{className:m().main,children:[(0,s.jsx)(c.m,{title:O.facilityName,subtitle:"CQC Location ID: ".concat(O.cqcLocationId),topicCatalogVersion:v.topicCatalogVersion,topicCatalogHash:v.topicCatalogHash,prsLogicVersion:v.prsLogicVersion,prsLogicHash:v.prsLogicHash,snapshotTimestamp:v.snapshotTimestamp,domain:v.domain,reportingDomain:v.reportingDomain}),(0,s.jsx)(d.I,{topicCatalogVersion:v.topicCatalogVersion,topicCatalogHash:v.topicCatalogHash,prsLogicVersion:v.prsLogicVersion,prsLogicHash:v.prsLogicHash,snapshotTimestamp:v.snapshotTimestamp,domain:v.domain,reportingDomain:v.reportingDomain}),(0,s.jsxs)("section",{className:m().section,children:[(0,s.jsxs)("div",{className:m().sectionHeader,children:[(0,s.jsx)("h2",{className:m().sectionTitle,children:"Facility Details"}),h&&(0,s.jsx)("button",{className:m().overviewButton,onClick:()=>p.push("/overview?provider=".concat(h,"&facility=").concat(u)),"data-testid":"continue-overview-button",children:"Continue to Overview"})]}),(0,s.jsxs)("div",{className:m().detailsGrid,children:[(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Provider ID:"}),(0,s.jsx)("span",{className:m().detailValueMono,children:O.providerId})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Facility ID:"}),(0,s.jsx)("span",{className:m().detailValueMono,children:O.id})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Address:"}),(0,s.jsxs)("span",{className:m().detailValue,children:[O.addressLine1,", ",O.townCity,", ",O.postcode]})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"CQC Location ID:"}),(0,s.jsx)("span",{className:m().detailValue,children:O.cqcLocationId})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Service Type:"}),(0,s.jsx)("span",{className:m().detailValue,children:O.serviceType})]}),O.capacity&&(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Capacity:"}),(0,s.jsx)("span",{className:m().detailValue,children:O.capacity})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"Facility Hash:"}),(0,s.jsx)("span",{className:m().detailValueMono,children:O.facilityHash})]}),(0,s.jsxs)("div",{className:m().detailItem,children:[(0,s.jsx)("span",{className:m().detailLabel,children:"As Of:"}),(0,s.jsx)("span",{className:m().detailValue,children:O.asOf})]})]})]}),(0,s.jsxs)("section",{className:m().section,children:[(0,s.jsxs)("div",{className:m().sectionHeader,children:[(0,s.jsx)("h2",{className:m().sectionTitle,children:"Evidence"}),(0,s.jsx)("button",{className:m().uploadButton,onClick:()=>C(!b),"data-testid":"toggle-upload-button",children:b?"Cancel Upload":"Upload Evidence"})]}),b&&(0,s.jsxs)("form",{onSubmit:P,className:m().uploadForm,children:[R&&(0,s.jsx)("div",{className:m().error,children:R}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"file",className:m().label,children:"File (PDF, Image, Document)"}),(0,s.jsx)("input",{id:"file",type:"file",onChange:e=>{var a;I((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},className:m().fileInput,disabled:V,"data-testid":"file-input",accept:".pdf,.png,.jpg,.jpeg,.doc,.docx"}),L&&(0,s.jsx)("span",{className:m().fileName,children:L.name})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"evidenceType",className:m().label,children:"Evidence Type"}),(0,s.jsxs)("select",{id:"evidenceType",value:T,onChange:e=>D(e.target.value),className:m().select,disabled:V,"data-testid":"evidence-type-select",children:[(0,s.jsx)("option",{value:"CQC_REPORT",children:"CQC Report"}),(0,s.jsx)("option",{value:"POLICY_DOCUMENT",children:"Policy Document"}),(0,s.jsx)("option",{value:"TRAINING_RECORD",children:"Training Record"}),(0,s.jsx)("option",{value:"CERTIFICATE",children:"Certificate"}),(0,s.jsx)("option",{value:"OTHER",children:"Other"})]})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"description",className:m().label,children:"Description (optional)"}),(0,s.jsx)("textarea",{id:"description",value:H,onChange:e=>E(e.target.value),className:m().textarea,disabled:V,"data-testid":"description-input",rows:3})]}),(0,s.jsx)("button",{type:"submit",className:m().submitButton,disabled:V||!L,"data-testid":"primary-upload-evidence",children:V?"Uploading...":"Upload"})]}),(0,s.jsx)("div",{className:m().evidenceList,children:0===x.evidence.length?(0,s.jsx)("div",{className:m().empty,children:"No evidence uploaded yet."}):x.evidence.map(e=>(0,s.jsxs)("div",{className:m().evidenceCard,children:[(0,s.jsx)("h4",{className:m().evidenceTitle,children:e.fileName}),(0,s.jsxs)("div",{className:m().evidenceDetails,children:[(0,s.jsxs)("span",{className:m().evidenceDetail,children:["Type: ",e.mimeType]}),(0,s.jsxs)("span",{className:m().evidenceDetail,children:["Uploaded: ",new Date(e.uploadedAt).toLocaleDateString()]}),(0,s.jsxs)("span",{className:m().evidenceDetail,children:["Evidence: ",e.evidenceType]})]}),(0,s.jsxs)("div",{className:m().evidenceHash,children:["Hash: ",e.blobHash.substring(0,16),"..."]})]},e.evidenceRecordId))})]})]})]})}},9156:function(e){e.exports={layout:"page_layout__89xst",main:"page_main__PAoHw",loading:"page_loading__jwB3E",error:"page_error__hzws8",section:"page_section__FKzzP",sectionHeader:"page_sectionHeader__ijry6",sectionTitle:"page_sectionTitle___dWEh",overviewButton:"page_overviewButton__5wceo",detailsGrid:"page_detailsGrid__A0hFT",detailItem:"page_detailItem__VIpb7",detailLabel:"page_detailLabel__qOPXP",detailValue:"page_detailValue__iKsQV",detailValueMono:"page_detailValueMono__o2Shy",uploadButton:"page_uploadButton__xp_HR",uploadForm:"page_uploadForm__0xhkK",formGroup:"page_formGroup__mCLs3",label:"page_label__AzTHW",fileInput:"page_fileInput__mmGOe",select:"page_select__MfvCM",textarea:"page_textarea__EX2Ds",fileName:"page_fileName__aAqBH",submitButton:"page_submitButton__fneEe",evidenceList:"page_evidenceList__7HJoW",evidenceCard:"page_evidenceCard__afeYD",evidenceTitle:"page_evidenceTitle__vtMvG",evidenceDetails:"page_evidenceDetails__bARO3",evidenceDetail:"page_evidenceDetail__6vHWS",evidenceHash:"page_evidenceHash__Aky28",empty:"page_empty__JmRW7"}}},function(e){e.O(0,[357,33,365,939,325,744],function(){return e(e.s=4364)}),_N_E=e.O()}]);